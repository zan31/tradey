{"ast":null,"code":"import jQuery from \"jquery\";\nimport \"jquery-ui/ui/widgets/sortable\";\nimport * as bootstrap from \"bootstrap/dist/js/bootstrap.esm\";\nimport flatpickr from \"flatpickr\";\nimport I18n from \"./i18n\";\n\n(function ($) {\n  document.addEventListener(\"rails_admin.dom_ready\", function (event) {\n    var $editors, array, config_options, goBootstrapWysihtml5s, goCkeditors, goCodeMirrors, goFroalaWysiwygs, goSimpleMDEs, options;\n    var content = event.detail || $(\"form\");\n\n    if (content.length) {\n      content.find(\"[data-datetimepicker]\").each(function () {\n        flatpickr(this, $.extend({\n          dateFormat: \"Y-m-dTH:i:S\",\n          altInput: true,\n          locale: I18n.locale\n        }, $(this).data(\"options\")));\n      });\n      content.find(\"[data-enumeration]\").each(function () {\n        if ($(this).is(\"[multiple]\")) {\n          $(this).filteringMultiselect($(this).data(\"options\"));\n        } else {\n          $(this).filteringSelect($(this).data(\"options\"));\n        }\n      });\n      content.find(\"[data-fileupload]\").each(function () {\n        var parent;\n        parent = $(this).closest(\".controls\");\n        parent.find(\".btn-remove-image\").on(\"click\", function () {\n          $(this).siblings(\"[type=checkbox]\").click();\n          parent.find(\".toggle\").toggle(\"slow\");\n          $(this).toggleClass(\"btn-danger btn-info\");\n          return false;\n        });\n      });\n      content.find(\"[data-fileupload]\").change(function () {\n        var ext, image_container, input, reader;\n        input = this;\n        image_container = $(\"#\" + input.id).parent().children(\".preview\");\n\n        if (!image_container.length) {\n          image_container = $(\"#\" + input.id).parent().prepend($(\"<img />\").addClass(\"preview\").addClass(\"img-thumbnail\")).find(\"img.preview\");\n          image_container.parent().find(\"img:not(.preview)\").hide();\n        }\n\n        ext = $(\"#\" + input.id).val().split(\".\").pop().toLowerCase();\n\n        if (input.files && input.files[0] && $.inArray(ext, [\"gif\", \"png\", \"jpg\", \"jpeg\", \"bmp\"]) !== -1) {\n          reader = new FileReader();\n\n          reader.onload = function (e) {\n            image_container.attr(\"src\", e.target.result);\n          };\n\n          reader.readAsDataURL(input.files[0]);\n          image_container.show();\n        } else {\n          image_container.hide();\n        }\n      });\n      content.find(\"[data-multiple-fileupload]\").each(function () {\n        $(this).closest(\".controls\").find(\".btn-remove-image\").on(\"click\", function () {\n          $(this).siblings(\"[type=checkbox]\").click();\n          $(this).parent(\".toggle\").toggle(\"slow\");\n          $(this).toggleClass(\"btn-danger btn-info\");\n          return false;\n        }).end().sortable({\n          items: \".sortables\"\n        });\n      });\n      content.find(\"[data-multiple-fileupload]\").change(function () {\n        var ext, file, i, image_container, input, len, ref, results;\n        input = this;\n        $(\"#\" + input.id).parent().children(\".preview\").remove();\n        ref = input.files;\n        results = [];\n\n        for (i = 0, len = ref.length; i < len; i++) {\n          file = ref[i];\n          ext = file.name.split(\".\").pop().toLowerCase();\n\n          if ($.inArray(ext, [\"gif\", \"png\", \"jpg\", \"jpeg\", \"bmp\"]) === -1) {\n            continue;\n          }\n\n          image_container = $(\"<img />\").addClass(\"preview\").addClass(\"img-thumbnail\");\n          results.push(function (image_container) {\n            var reader;\n            reader = new FileReader();\n\n            reader.onload = function (e) {\n              image_container.attr(\"src\", e.target.result);\n            };\n\n            reader.readAsDataURL(file);\n            return $(\"#\" + input.id).parent().append($(\"<div></div>\").addClass(\"preview\").append(image_container));\n          }(image_container));\n        }\n\n        return results;\n      });\n      content.find(\"[data-filteringmultiselect]\").each(function () {\n        $(this).filteringMultiselect($(this).data(\"options\"));\n\n        if ($(this).parents(\"#modal\").length) {\n          $(this).parent().siblings(\".modal-actions\").remove();\n        } else {\n          $(this).parents(\".control-group\").first().remoteForm();\n        }\n      });\n      content.find(\"[data-filteringselect]\").each(function () {\n        $(this).filteringSelect($(this).data(\"options\"));\n\n        if ($(this).parents(\"#modal\").length) {\n          $(this).parent().siblings(\".modal-actions\").remove();\n        } else {\n          $(this).parents(\".control-group\").first().remoteForm();\n        }\n      });\n      content.find(\"[data-nestedmany]\").each(function () {\n        var field, nav, tab_content, toggler;\n        field = $(this).parents(\".control-group\").first();\n        nav = field.find(\"> .controls > .nav\");\n        tab_content = field.find(\"> .tab-content\");\n        toggler = field.find(\"> .controls > .btn-group > .toggler\");\n        tab_content.children(\".fields:not(.tab-pane)\").addClass(\"tab-pane\").each(function () {\n          $(this).attr(\"id\", \"unique-id-\" + new Date().getTime() + Math.floor(Math.random() * 100000));\n          nav.append($(\"<li></li>\").append($(\"<a></a>\").addClass(\"nav-link\").attr(\"data-bs-toggle\", \"tab\").attr(\"href\", \"#\" + this.id).text($(this).children(\".object-infos\").data(\"object-label\"))).addClass(\"nav-item\"));\n        });\n\n        if (nav.find(\"> li.active\").length === 0) {\n          nav.find(\"> li > a[data-bs-toggle='tab']:first\").each(function (index, element) {\n            bootstrap.Tab.getOrCreateInstance(element).show();\n          });\n        }\n\n        if (nav.children().length === 0) {\n          toggler.addClass(\"disabled\").removeClass(\"active\").children(\"i\").addClass(\"fa-chevron-right\");\n        } else {\n          if (toggler.hasClass(\"active\")) {\n            $(toggler.data(\"bs-target\")).addClass(\"show\");\n            toggler.children(\"i\").addClass(\"fa-chevron-down\");\n          } else {\n            toggler.children(\"i\").addClass(\"fa-chevron-right\");\n          }\n        }\n      });\n      content.find(\"[data-nestedone]\").each(function () {\n        var field, first_tab, nav, tab_content, toggler;\n        field = $(this).parents(\".control-group\").first();\n        nav = field.find(\"> .controls > .nav\");\n        tab_content = field.find(\"> .tab-content\");\n        toggler = field.find(\"> .controls > .btn-group > .toggler\");\n        tab_content.children(\".fields:not(.tab-pane)\").addClass(\"tab-pane active\").each(function () {\n          field.find(\"> .controls .add_nested_fields\").removeClass(\"add_nested_fields\").text($(this).children(\".object-infos\").data(\"object-label\"));\n          nav.append($(\"<li></li>\").append($(\"<a></a>\").attr(\"data-bs-toggle\", \"tab\").attr(\"href\", \"#\" + $(this).id).text($(this).children(\".object-infos\").data(\"object-label\"))));\n        });\n        first_tab = nav.find(\"> li > a[data-bs-toggle='tab']:first\");\n        first_tab.each(function (index, element) {\n          bootstrap.Tab.getOrCreateInstance(element).show();\n        });\n        field.find(\"> .controls > [data-target]:first\").html('<i class=\"fas\"></i> ' + first_tab.html());\n        nav.hide();\n\n        if (nav.children().length === 0) {\n          toggler.addClass(\"disabled\").removeClass(\"active\").children(\"i\").addClass(\"fa-chevron-right\");\n        } else {\n          if (toggler.hasClass(\"active\")) {\n            $(toggler.data(\"bs-target\")).addClass(\"show\");\n            toggler.children(\"i\").addClass(\"fa-chevron-down\");\n          } else {\n            toggler.children(\"i\").addClass(\"fa-chevron-right\");\n          }\n        }\n      });\n      content.find(\"[data-polymorphic]\").each(function () {\n        var field, object_select, type_select, urls;\n        type_select = $(this);\n        field = type_select.parents(\".control-group\").first();\n        object_select = field.find(\"select\").last();\n        urls = type_select.data(\"urls\");\n        type_select.on(\"change\", function (e) {\n          var selected_data, selected_type;\n          selected_type = type_select.val().toLowerCase().replace(/::/g, \"-\");\n          selected_data = $(\"#\" + selected_type + \"-js-options\").data(\"options\");\n          object_select.data(\"options\", selected_data);\n          object_select.filteringSelect(\"destroy\");\n          object_select.filteringSelect(selected_data);\n        });\n      });\n\n      goSimpleMDEs = function goSimpleMDEs() {\n        return content.find(\"[data-richtext=simplemde]\").not(\".simplemded\").each(function (index, domEle) {\n          var instance_config, options;\n          options = $(this).data(\"options\");\n          instance_config = options.instance_config;\n          new window.SimpleMDE($.extend(true, {\n            element: document.getElementById(this.id),\n            autosave: {\n              uniqueId: this.id\n            }\n          }, instance_config));\n          $(this).addClass(\"simplemded\");\n        });\n      };\n\n      $editors = content.find(\"[data-richtext=simplemde]\").not(\".simplemded\");\n\n      if ($editors.length) {\n        if (!window.SimpleMDE) {\n          options = $editors.first().data(\"options\");\n          $(\"head\").append('<link href=\"' + options[\"css_location\"] + '\" rel=\"stylesheet\" media=\"all\" type=\"text/css\">');\n          $.getScript(options[\"js_location\"], function (script, textStatus, jqXHR) {\n            return goSimpleMDEs();\n          });\n        } else {\n          goSimpleMDEs();\n        }\n      }\n\n      goCkeditors = function goCkeditors() {\n        return content.find(\"[data-richtext=ckeditor]\").not(\".ckeditored\").each(function (index, domEle) {\n          var instance;\n\n          try {\n            if (instance = window.CKEDITOR.instances[this.id]) {\n              instance.destroy(true);\n            }\n          } catch (error1) {}\n\n          window.CKEDITOR.replace(this, $(this).data(\"options\").options);\n          $(this).addClass(\"ckeditored\");\n        });\n      };\n\n      $editors = content.find(\"[data-richtext=ckeditor]\").not(\".ckeditored\");\n\n      if ($editors.length) {\n        if (!window.CKEDITOR) {\n          options = $editors.first().data(\"options\");\n          window.CKEDITOR_BASEPATH = options[\"base_location\"];\n          $.getScript(options[\"jspath\"], function (_this) {\n            return function (script, textStatus, jqXHR) {\n              return goCkeditors();\n            };\n          }(this));\n        } else {\n          goCkeditors();\n        }\n      }\n\n      goCodeMirrors = function (_this) {\n        return function (array) {\n          return array.each(function (index, domEle) {\n            var textarea;\n            options = $(this).data(\"options\");\n            textarea = this;\n            $.getScript(options[\"locations\"][\"mode\"], function (script, textStatus, jqXHR) {\n              options = $(domEle).data(\"options\");\n              $(\"head\").append('<link href=\"' + options[\"locations\"][\"theme\"] + '\" rel=\"stylesheet\" media=\"all\" type=\"text/css\">');\n              CodeMirror.fromTextArea(textarea, options[\"options\"]);\n              return $(textarea).addClass(\"codemirrored\");\n            });\n          });\n        };\n      }(this);\n\n      array = content.find(\"[data-richtext=codemirror]\").not(\".codemirrored\");\n\n      if (array.length) {\n        this.array = array;\n\n        if (!window.CodeMirror) {\n          options = $(array[0]).data(\"options\");\n          $(\"head\").append('<link href=\"' + options[\"csspath\"] + '\" rel=\"stylesheet\" media=\"all\" type=\"text/css\">');\n          $.getScript(options[\"jspath\"], function (_this) {\n            return function (script, textStatus, jqXHR) {\n              return goCodeMirrors(_this.array);\n            };\n          }(this));\n        } else {\n          goCodeMirrors(this.array);\n        }\n      }\n\n      goBootstrapWysihtml5s = function (_this) {\n        return function (array, config_options) {\n          return array.each(function () {\n            $(this).addClass(\"bootstrap-wysihtml5ed\");\n            $(this).closest(\".controls\").addClass(\"well\");\n            $(this).wysihtml5(config_options);\n          });\n        };\n      }(this);\n\n      array = content.find(\"[data-richtext=bootstrap-wysihtml5]\").not(\".bootstrap-wysihtml5ed\");\n\n      if (array.length) {\n        this.array = array;\n        options = $(array[0]).data(\"options\");\n        config_options = $.parseJSON(options[\"config_options\"]);\n\n        if (!window.wysihtml5) {\n          $(\"head\").append('<link href=\"' + options[\"csspath\"] + '\" rel=\"stylesheet\" media=\"all\" type=\"text/css\">');\n          $.getScript(options[\"jspath\"], function (_this) {\n            return function (script, textStatus, jqXHR) {\n              return goBootstrapWysihtml5s(_this.array, config_options);\n            };\n          }(this));\n        } else {\n          goBootstrapWysihtml5s(this.array, config_options);\n        }\n      }\n\n      goFroalaWysiwygs = function (_this) {\n        return function (array) {\n          return array.each(function () {\n            var uploadEnabled;\n            options = $(this).data(\"options\");\n            config_options = $.parseJSON(options[\"config_options\"]);\n\n            if (config_options) {\n              if (!config_options[\"inlineMode\"]) {\n                config_options[\"inlineMode\"] = false;\n              }\n            } else {\n              config_options = {\n                inlineMode: false\n              };\n            }\n\n            uploadEnabled = config_options[\"imageUploadURL\"] ? config_options[\"imageUploadParams\"] = {\n              authenticity_token: $(\"meta[name=csrf-token]\").attr(\"content\")\n            } : void 0;\n            $(this).addClass(\"froala-wysiwyged\");\n            $(this).froalaEditor(config_options);\n\n            if (uploadEnabled) {\n              $(this).on(\"froalaEditor.image.error\", function (e, editor, error) {\n                alert(\"error uploading image: \" + error.message);\n              }).on(\"froalaEditor.image.removed\", function (e, editor, $img) {\n                editor.options.imageDeleteParams = {\n                  src: $img.attr(\"src\"),\n                  authenticity_token: $(\"meta[name=csrf-token]\").attr(\"content\")\n                };\n                editor.deleteImage($img);\n              }).on(\"editable.imageDeleteSuccess\", function (e, editor, data) {}).on(\"editable.imageDeleteError\", function (e, editor, error) {\n                alert(\"error deleting image: \" + error.message);\n              });\n            }\n          });\n        };\n      }(this);\n\n      array = content.find(\"[data-richtext=froala-wysiwyg]\").not(\".froala-wysiwyged\");\n\n      if (array.length) {\n        options = $(array[0]).data(\"options\");\n\n        if (!$.isFunction($.fn.editable)) {\n          $(\"head\").append('<link href=\"' + options[\"csspath\"] + '\" rel=\"stylesheet\" media=\"all\" type=\"text/css\">');\n          $.getScript(options[\"jspath\"], function (_this) {\n            return function (script, textStatus, jqXHR) {\n              return goFroalaWysiwygs(array);\n            };\n          }(this));\n        } else {\n          goFroalaWysiwygs(array);\n        }\n      }\n\n      return content.find(\"trix-editor\").each(function () {\n        if (!window.Trix) {\n          options = $(this).data(\"options\");\n          $(\"head\").append('<link href=\"' + options[\"csspath\"] + '\" rel=\"stylesheet\" media=\"all\" type=\"text/css\">');\n          return $.getScript(options[\"jspath\"]);\n        }\n      });\n    }\n  });\n})(jQuery);","map":null,"metadata":{},"sourceType":"module"}