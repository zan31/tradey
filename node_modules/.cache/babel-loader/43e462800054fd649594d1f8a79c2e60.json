{"ast":null,"code":"function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nimport logger from \"./logger\"; // Responsible for ensuring channel subscribe command is confirmed, retrying until confirmation is received.\n// Internal class, not intended for direct user manipulation.\n\nvar SubscriptionGuarantor = /*#__PURE__*/function () {\n  function SubscriptionGuarantor(subscriptions) {\n    _classCallCheck(this, SubscriptionGuarantor);\n\n    this.subscriptions = subscriptions;\n    this.pendingSubscriptions = [];\n  }\n\n  _createClass(SubscriptionGuarantor, [{\n    key: \"guarantee\",\n    value: function guarantee(subscription) {\n      if (this.pendingSubscriptions.indexOf(subscription) == -1) {\n        logger.log(\"SubscriptionGuarantor guaranteeing \".concat(subscription.identifier));\n        this.pendingSubscriptions.push(subscription);\n      } else {\n        logger.log(\"SubscriptionGuarantor already guaranteeing \".concat(subscription.identifier));\n      }\n\n      this.startGuaranteeing();\n    }\n  }, {\n    key: \"forget\",\n    value: function forget(subscription) {\n      logger.log(\"SubscriptionGuarantor forgetting \".concat(subscription.identifier));\n      this.pendingSubscriptions = this.pendingSubscriptions.filter(function (s) {\n        return s !== subscription;\n      });\n    }\n  }, {\n    key: \"startGuaranteeing\",\n    value: function startGuaranteeing() {\n      this.stopGuaranteeing();\n      this.retrySubscribing();\n    }\n  }, {\n    key: \"stopGuaranteeing\",\n    value: function stopGuaranteeing() {\n      clearTimeout(this.retryTimeout);\n    }\n  }, {\n    key: \"retrySubscribing\",\n    value: function retrySubscribing() {\n      var _this = this;\n\n      this.retryTimeout = setTimeout(function () {\n        if (_this.subscriptions && typeof _this.subscriptions.subscribe === \"function\") {\n          _this.pendingSubscriptions.map(function (subscription) {\n            logger.log(\"SubscriptionGuarantor resubscribing \".concat(subscription.identifier));\n\n            _this.subscriptions.subscribe(subscription);\n          });\n        }\n      }, 500);\n    }\n  }]);\n\n  return SubscriptionGuarantor;\n}();\n\nexport default SubscriptionGuarantor;","map":null,"metadata":{},"sourceType":"module"}